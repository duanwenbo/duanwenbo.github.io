<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Digest | SQL Quick Note 2 | 🤗 Wenbo'Log</title>
<meta name=keywords content="Notes"><meta name=description content="Transaction


Transaction is a series of queries


It&rsquo;s the unit of operation


Non-devisible, either all queries executed, either none


Important way to maintain consistency and data integrity
BEGIN TRANSACTION
SELECT * FROM A
COMMIT;
ROLLBACK;


Atomicity

The transaction is indivisible
Rollback when failed

The Atomicity is achived by Undo Log

Undo log stores the reversve operation logic with every queries
Undo log is stored in the different table space
It will mainly record the value and operation
If a ROLLBACK invoked, the data is able to be restored by undo-log

Consistency


Consistency refers to data consistency and read consistency"><meta name=author content="Wenbo"><link rel=canonical href=http://localhost:1313/posts/transaction/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/transaction/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><meta property="og:title" content="Digest | SQL Quick Note 2"><meta property="og:description" content="Transaction


Transaction is a series of queries


It&rsquo;s the unit of operation


Non-devisible, either all queries executed, either none


Important way to maintain consistency and data integrity
BEGIN TRANSACTION
SELECT * FROM A
COMMIT;
ROLLBACK;


Atomicity

The transaction is indivisible
Rollback when failed

The Atomicity is achived by Undo Log

Undo log stores the reversve operation logic with every queries
Undo log is stored in the different table space
It will mainly record the value and operation
If a ROLLBACK invoked, the data is able to be restored by undo-log

Consistency


Consistency refers to data consistency and read consistency"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/transaction/"><meta property="og:image" content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-13T23:30:31+00:00"><meta property="article:modified_time" content="2025-01-13T23:30:31+00:00"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Digest | SQL Quick Note 2"><meta name=twitter:description content="Transaction


Transaction is a series of queries


It&rsquo;s the unit of operation


Non-devisible, either all queries executed, either none


Important way to maintain consistency and data integrity
BEGIN TRANSACTION
SELECT * FROM A
COMMIT;
ROLLBACK;


Atomicity

The transaction is indivisible
Rollback when failed

The Atomicity is achived by Undo Log

Undo log stores the reversve operation logic with every queries
Undo log is stored in the different table space
It will mainly record the value and operation
If a ROLLBACK invoked, the data is able to be restored by undo-log

Consistency


Consistency refers to data consistency and read consistency"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Digest | SQL Quick Note 2","item":"http://localhost:1313/posts/transaction/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Digest | SQL Quick Note 2","name":"Digest | SQL Quick Note 2","description":"Transaction Transaction is a series of queries\nIt\u0026rsquo;s the unit of operation\nNon-devisible, either all queries executed, either none\nImportant way to maintain consistency and data integrity\nBEGIN TRANSACTION SELECT * FROM A COMMIT; ROLLBACK; Atomicity The transaction is indivisible Rollback when failed The Atomicity is achived by Undo Log Undo log stores the reversve operation logic with every queries Undo log is stored in the different table space It will mainly record the value and operation If a ROLLBACK invoked, the data is able to be restored by undo-log Consistency Consistency refers to data consistency and read consistency\n","keywords":["Notes"],"articleBody":"Transaction Transaction is a series of queries\nIt’s the unit of operation\nNon-devisible, either all queries executed, either none\nImportant way to maintain consistency and data integrity\nBEGIN TRANSACTION SELECT * FROM A COMMIT; ROLLBACK; Atomicity The transaction is indivisible Rollback when failed The Atomicity is achived by Undo Log Undo log stores the reversve operation logic with every queries Undo log is stored in the different table space It will mainly record the value and operation If a ROLLBACK invoked, the data is able to be restored by undo-log Consistency Consistency refers to data consistency and read consistency\nData Consistency means the data can be cross valided by different logfic on different places. Read Consistency means no lag in reading data? Consistency is the goal, A, I, and D are the approaches.\nIsolation Isolation is the key feaures to ensure the concurrency while not affecting data consistency and integrety 4 scenarios that needs to be optimised by different level of isolations Read-Read: No affect Write-Write: Two transactions writing on the same field. Add Lock Read-Write: Read-write scenarios will results in a lot of issues if not setting the isolation level properly. It will lead: Dirty Read, Un-repeatable Read and Phantom read. Different lock in Read-read: By Lock mode:\nExclusive lock (X)\nOther transaction are not allowed any read/write operations on the locked row START TRANSACTION; UPDATE table_name SET column1 = 'value' WHERE id = 1; -- X锁加在id=1的行上 UPDATE table_name SET column1 = 'value' WHERE id = 1 FOR UPDATE; -- 显式上X锁加在id=1的行上 UPDATE table_name SET column1 = '1' WHERE id = '1' FOR UPDATE SELECT column1 FROM table_name where id = '2' FOR UPDATE SELECT ... FOR UPDATE：对特定记录加X锁。\nUPDATE / DELETE / INSERT：自动加X锁。\nLOCK TABLE ... IN EXCLUSIVE MODE：对整张表加X锁。\nRelease after commit or rollback Shared Lock （S）\nEnsure the read row is read-only\nSELECT column1, column2 FROM table_name WHERE condition FOR SHARE; SELECT column1 FROM table_name WHERE id = 'a' LOCK IN SHARE MODE Release after commit or rollback\nIntend lock (IS or IX)\nIt is applied on a page level; This is for indicating a transaction is intends to set a S/X lock on individual row level, to prevent the potential conflicts For example: Transaction A, Row A has a S lock Table AA will be added with an IS lock automatically When Transaction B is going to add an X lock on Table AA before A is committed, it will block Update Lock (U)\nAvoid the dead lock when two transaction want to update the same target while the raw has added S lock by both of the transaction\nExample:\nBEGIN; SELECT * FROM orders WHERE id = 1 WITH (UPDLOCK); -- 加 U锁 -- 决定更新数据，U锁升级为 X锁 UPDATE orders SET status = 'processed' WHERE id = 1; COMMIT; BEGIN; SELECT * FROM orders WHERE id = 1 WITH (UPDLOCK); -- 加 U锁，被阻塞直到事务A完成 -- 决定更新数据 UPDATE orders SET status = 'canceled' WHERE id = 1; COMMIT; Dead Lock Example:\n事务A对某行加S锁。 事务B对同一行加S锁。 事务A尝试将S锁升级为X锁，但需要等待事务B释放S锁。 事务B也尝试将S锁升级为X锁，但需要等待事务A释放S锁. 结果：事务A和事务B相互等待，发生死锁。 Record Lock\nGap Lock\nNext Key Lock\nHow to optimise the concurrency in Read-Write Scenarios Different isolation level: Read uncommited: The in-flight transaction can read the uncommited change. Read commited: The in-flight transaction can read the commited change only .It avoids the dirty read Repeatable read: The in-flight transaction can only read the transaction that’s been commited before the current transaction. It avoids the dirty read and unrepeatable read. Serilizable Only one transaction is permitted at a moment. Read Committed and Repeated Read is achived by Multi-version Concurrency Control (MVCC) Three Important components of MVCC: Hidden Fields: Transaction ID and Roll back pointer The readview The Undo log chain By comparing the current transaction id and the trasnaction id in the undo log chain Durability The Durability is achievd by Redo Log\nEvery transaction will be write in Redo Log. Redo log stored in the ROM Transaction applied on the buffer pool buffer pool flashes the datafile on ROM regularly A complete process of executing a transaction Transaction Begin Lookingfor or Loading the data in the Buffer Pool Record the operations on Undo Log Update the Memory Data: Including Buffer Pool and Redo Log Buffer Write the Redo Log on disk drive Commit the transaction Record all operations of the transaction in BinLog The changed value on buffer pool will be flashed to disk regularly Index Why Do We Need an Index? Without an index, searching for a specific row in a table involves scanning all rows sequentially, resulting in a time complexity of O(n) for read operations. Indexing accelerates query performance by enabling faster lookups, particularly in large datasets. How data stored in DB Logically, they are stored as rows and columns in DB Hash Index What Is a Hash Index? A hash index is a data structure that accelerates query operations by creating a mapping between key values in one or more columns of a table and their corresponding storage locations.\nHow It Works: Hash Function Each key value is passed through a hash function, which transforms the key into a hash value. A good hash function ensures that inputs are distributed uniformly across the hash space, minimizing clustering and hash collisions. Bucket Mapping The number of buckets, mm, is determined, which represents storage divisions in memory. The specific bucket for a key is calculated as:Bucket Index=Hash Function(key)mod mBucket Index=Hash Function(key)modm Handling Hash Collisions Collision Definition: Two different keys may produce the same hash value, resulting in a collision. Collision Resolution Methods Chaining (Linked List): Multiple values mapped to the same bucket are stored in a linked list. Open Addressing: If a bucket is already occupied, an alternative bucket is located based on a probing sequence (e.g., linear probing or quadratic probing). Storage of Hash Index: The hash index is typically stored in RAM for fast access. To ensure data durability in the event of failure, Write-Ahead Logging (WAL) or other persistence mechanisms can be used. Pointer to Data Rows: The value in a hash index is a pointer or reference to the row in the table, allowing direct access to the data. Time Complexity of Hash Index Average Case: O(1)for lookups, insertions, and deletions, as hash functions provide direct access to buckets. Worst Case: O(n), which occurs when hash collisions lead to a single bucket storing many entries (e.g., all keys hashing to the same bucket). Why Use a Hash Index? Advantages: Efficient Query Performance Hash indices provide constant-time O(1)O(1) lookups for equality-based queries (= or IN). Low Memory Overhead Hash indices are compact and require less memory compared to tree-based indices like B-trees. Limitations: No Range Query Support Hash indices are unsuitable for range queries (e.g., \u003c, \u003e, BETWEEN) because hash functions do not preserve order. Random Distribution of Keys Hash functions distribute keys randomly across buckets, making ordered operations (like ORDER BY) impossible using the index. Collision Overhead Handling hash collisions adds complexity and may degrade performance in scenarios with poor hash function design or high data skew. Additions and Enhancements Durability: While you mentioned WAL for durability, it’s worth noting that hash indices are often rebuilt after a crash if stored only in memory, making them better suited for temporary tables or volatile workloads. Comparison to Other Index Types: Compared to B-tree indices: Hash indices are faster for equality queries. B-trees are more versatile, supporting range queries, order maintenance, and prefix matching. Common Use Cases: Hash indices are ideal for: Lookup tables with frequent equality queries. Key-value stores and in-memory databases (e.g., Redis). Indexing columns with unique or near-unique values. How to implement Hash Index CREATE TABLE test ( id INT, value VARCHAR(255), PRIMARY KEY (id), KEY(value) USING HASH ) ENGINE=Memory; B Tree Why do we need B-Tree We want to query the data in log time What is B-Tree It’s a balance tree: All the leaf nodes are on the same level Multi-branching: With a m-order B-tree, it has Maximum m child nodes, minimum m/2 child nodes Maximum m-1 keys in one node, minimum m/2 -1 leys in one node (except for the root node) Order: Every keys are sorted in a ascending order The value stored on each key is the pointer pointing to the corresponding row Insertion in B-Tree Starting from the root node, and navigating to the corresponding position on the leaf node. All keys in the node are sorted in the ascending order. If the number of keys is greater than m-1, split the node into two, and push the middle key as the father node. (anchestor node?) Deletion in B-Tree Starting from the root node, and navigating to the corresponding position. If the deletion target is the leaf node, delete it, If the number of nodes after deleetion is smaller than m/2-1, take the sbling node as the new seperator in the parent node, and take the original seperator into the target leaf node If the sbling node is also at the minumum nodes, then we can merge the target node, the separator and the sbling node together If the target node is non-leaf node, we have to find an alternative key as the seprator, this could be the largest key on the left-hand child node, or the smallest key of the righ-hand side child node I/O of B-Tree The B-Tree is stored in hard Drive\nEach time, it will read a single level of nodes into the RAM\nB+ Tree Difference from B-Tree:\nIn B-Tree, the values of all nodes contains to pointer pointing to the record In B-Tree, only the leaf node contains the pointer pointing to the record m order B-tree has maximum m-1 keys in a single mode m order B+ tree has maximum m keys in a single mode, each key on the non-leaf node is the maximum value of it’s childern node B+ Tree has an additional pointer starting at the leaf node. Making it easy to do sequantial search and range query ![image-20250112154345629](/Users/duanwenbo/Library/Application Support/typora-user-images/image-20250112154345629.png)\nClustered and non-clustered Index Note this is another dimention to describe index. The data srtrucuter is all B+ Tree by default. The major difference is either we put the real data or the pointer on the leaf node ","wordCount":"1686","inLanguage":"en","image":"http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-01-13T23:30:31Z","dateModified":"2025-01-13T23:30:31Z","author":{"@type":"Person","name":"Wenbo"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/transaction/"},"publisher":{"@type":"Organization","name":"🤗 Wenbo'Log","logo":{"@type":"ImageObject","url":"http://localhost:1313/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Wenbo'Log (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Wenbo'Log</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/ title=Posts><span>Posts</span></a></li><li><a href=http://localhost:1313/archive/ title=Archive><span>Archive</span></a></li><li><a href=http://localhost:1313/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=http://localhost:1313/categories/ title=Categories><span>Categories</span></a></li><li><a href=http://localhost:1313/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://www.emojisearch.app title=emojiSearch><span>emojiSearch</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Digest | SQL Quick Note 2</h1><div class=post-meta><span title='2025-01-13 23:30:31 +0000 UTC'>January 13, 2025</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;1686 words&nbsp;·&nbsp;Wenbo</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#transaction>Transaction</a></li><li><a href=#atomicity>Atomicity</a></li><li><a href=#consistency>Consistency</a></li><li><a href=#isolation>Isolation</a></li><li><a href=#durability>Durability</a></li><li><a href=#a-complete-process-of-executing-a-transaction>A complete process of executing a transaction</a></li><li><a href=#index>Index</a></li><li><a href=#hash-index>Hash Index</a></li><li><a href=#b-tree>B Tree</a></li><li><a href=#b-tree-1>B+ Tree</a></li><li><a href=#clustered-and-non-clustered-index>Clustered and non-clustered Index</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h3 id=transaction>Transaction<a hidden class=anchor aria-hidden=true href=#transaction>#</a></h3><ul><li><p>Transaction is a series of queries</p></li><li><p>It&rsquo;s the unit of operation</p></li><li><p>Non-devisible, either all queries executed, either none</p></li><li><p>Important way to maintain consistency and <em>data integrity</em></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>A</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ROLLBACK</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div></li></ul><h3 id=atomicity>Atomicity<a hidden class=anchor aria-hidden=true href=#atomicity>#</a></h3><ul><li>The transaction is indivisible</li><li>Rollback when failed</li></ul><h4 id=the-atomicity-is-achived-by-undo-log>The Atomicity is achived by Undo Log<a hidden class=anchor aria-hidden=true href=#the-atomicity-is-achived-by-undo-log>#</a></h4><ul><li>Undo log stores the reversve operation logic with every queries</li><li>Undo log is stored in the different table space</li><li>It will mainly record the value and operation</li><li>If a ROLLBACK invoked, the data is able to be restored by undo-log</li></ul><h3 id=consistency>Consistency<a hidden class=anchor aria-hidden=true href=#consistency>#</a></h3><ul><li><p>Consistency refers to data consistency and read consistency</p><ul><li><strong>Data Consistency</strong> means the data can be cross valided by different logfic on different places.</li><li><em><strong>Read Consistency</strong> means no lag in reading data?</em></li></ul></li><li><p>Consistency is the goal, A, I, and D are the approaches.</p></li></ul><h3 id=isolation>Isolation<a hidden class=anchor aria-hidden=true href=#isolation>#</a></h3><ul><li>Isolation is the key feaures to ensure the concurrency while not affecting data consistency and integrety</li></ul><h4 id=4-scenarios-that-needs-to-be-optimised-by-different-level-of-isolations>4 scenarios that needs to be optimised by different level of isolations<a hidden class=anchor aria-hidden=true href=#4-scenarios-that-needs-to-be-optimised-by-different-level-of-isolations>#</a></h4><ul><li><strong>Read-Read:</strong> No affect</li><li><strong>Write-Write:</strong> Two transactions writing on the same field. Add Lock</li><li><strong>Read-Write</strong>: Read-write scenarios will results in a lot of issues if not setting the isolation level properly. It will lead: <strong>Dirty Read</strong>, <strong>Un-repeatable Read</strong> and <strong>Phantom read</strong>.</li></ul><h4 id=different-lock-in-read-read>Different lock in Read-read:<a hidden class=anchor aria-hidden=true href=#different-lock-in-read-read>#</a></h4><ul><li><p>By Lock mode:</p><ul><li><p><strong>Exclusive lock (X)</strong></p><ul><li>Other transaction are not allowed any read/write operations on the locked row</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>START</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UPDATE</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>column1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;value&#39;</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=c1>-- X锁加在id=1的行上
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UPDATE</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>column1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;value&#39;</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=k>UPDATE</span><span class=p>;</span><span class=w> </span><span class=c1>-- 显式上X锁加在id=1的行上
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UPDATE</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>column1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=k>UPDATE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>column1</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;2&#39;</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=k>UPDATE</span><span class=w>
</span></span></span></code></pre></div><p><code>SELECT ... FOR UPDATE</code>：对特定记录加X锁。</p><p><code>UPDATE</code> / <code>DELETE</code> / <code>INSERT</code>：自动加X锁。</p><p><code>LOCK TABLE ... IN EXCLUSIVE MODE</code>：对整张表加X锁。</p><ul><li>Release after commit or rollback</li></ul></li><li><p><strong>Shared Lock （S）</strong></p><ul><li><p>Ensure the read row is read-only</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>column1</span><span class=p>,</span><span class=w> </span><span class=n>column2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=k>table_name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>condition</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FOR</span><span class=w> </span><span class=k>SHARE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>column1</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;a&#39;</span><span class=w> </span><span class=k>LOCK</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=k>SHARE</span><span class=w> </span><span class=k>MODE</span><span class=w> 
</span></span></span></code></pre></div></li><li><p>Release after commit or rollback</p></li></ul></li><li><p><strong>Intend lock (IS or IX)</strong></p><ul><li>It is applied on a page level;</li><li>This is for indicating a transaction is intends to set a S/X lock on individual row level, to prevent the potential conflicts</li><li>For example:<ul><li>Transaction A, Row A has a S lock</li><li>Table AA will be added with an IS lock automatically</li><li>When Transaction B is going to add an X lock on Table AA before A is committed, it will block</li></ul></li></ul></li><li><p><strong>Update Lock (U)</strong></p><ul><li><p>Avoid the dead lock when two transaction want to update the same target while the raw has added S lock by both of the transaction</p></li><li><p>Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=p>(</span><span class=n>UPDLOCK</span><span class=p>);</span><span class=w> </span><span class=c1>-- 加 U锁
</span></span></span><span class=line><span class=cl><span class=c1>-- 决定更新数据，U锁升级为 X锁
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UPDATE</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;processed&#39;</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=p>(</span><span class=n>UPDLOCK</span><span class=p>);</span><span class=w> </span><span class=c1>-- 加 U锁，被阻塞直到事务A完成
</span></span></span><span class=line><span class=cl><span class=c1>-- 决定更新数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UPDATE</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;canceled&#39;</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div></li></ul></li><li><p><strong>Dead Lock Example:</strong></p><ul><li>事务A对某行加S锁。</li><li>事务B对同一行加S锁。</li><li>事务A尝试将S锁升级为X锁，但需要等待事务B释放S锁。</li><li>事务B也尝试将S锁升级为X锁，但需要等待事务A释放S锁.</li><li>结果：事务A和事务B相互等待，发生死锁。</li></ul></li><li><p>Record Lock</p></li><li><p>Gap Lock</p></li><li><p>Next Key Lock</p></li></ul></li></ul><h4 id=how-to-optimise-the-concurrency-in-read-write-scenarios>How to optimise the concurrency in Read-Write Scenarios<a hidden class=anchor aria-hidden=true href=#how-to-optimise-the-concurrency-in-read-write-scenarios>#</a></h4><ul><li>Different isolation level:<ul><li><strong>Read uncommited:</strong> The in-flight transaction can read the uncommited change.</li><li><strong>Read commited</strong>: The in-flight transaction can read the commited change only .It avoids the dirty read</li><li><strong>Repeatable read</strong>: The in-flight transaction can only read the transaction that&rsquo;s been commited before the current transaction. It avoids the dirty read and unrepeatable read.</li><li><strong>Serilizable</strong> Only one transaction is permitted at a moment.</li></ul></li></ul><h4 id=read-committed-and-repeated-read-is-achived-by-multi-version-concurrency-control-mvcc>Read Committed and Repeated Read is achived by Multi-version Concurrency Control (MVCC)<a hidden class=anchor aria-hidden=true href=#read-committed-and-repeated-read-is-achived-by-multi-version-concurrency-control-mvcc>#</a></h4><ul><li>Three Important components of MVCC:<ul><li>Hidden Fields: Transaction ID and Roll back pointer</li><li>The readview</li><li>The Undo log chain</li></ul></li><li>By comparing the current transaction id and the trasnaction id in the undo log chain</li></ul><h3 id=durability>Durability<a hidden class=anchor aria-hidden=true href=#durability>#</a></h3><p>The Durability is achievd by Redo Log</p><ul><li>Every transaction will be write in Redo Log.</li><li>Redo log stored in the ROM</li><li>Transaction applied on the buffer pool</li><li>buffer pool flashes the datafile on ROM regularly</li></ul><h3 id=a-complete-process-of-executing-a-transaction>A complete process of executing a transaction<a hidden class=anchor aria-hidden=true href=#a-complete-process-of-executing-a-transaction>#</a></h3><ol><li>Transaction Begin</li><li>Lookingfor or Loading the data in the <strong>Buffer Pool</strong></li><li>Record the operations on <strong>Undo Log</strong></li><li>Update the Memory Data: Including Buffer Pool and Redo Log Buffer</li><li>Write the <strong>Redo Log</strong> on disk drive</li><li>Commit the transaction</li><li>Record all operations of the transaction in <strong>BinLog</strong></li><li>The changed value on buffer pool will be flashed to disk regularly</li></ol><h3 id=index>Index<a hidden class=anchor aria-hidden=true href=#index>#</a></h3><h4 id=why-do-we-need-an-index>Why Do We Need an Index?<a hidden class=anchor aria-hidden=true href=#why-do-we-need-an-index>#</a></h4><ul><li>Without an index, searching for a specific row in a table involves scanning all rows sequentially, resulting in a time complexity of <strong>O(n)</strong> for read operations.</li><li>Indexing accelerates query performance by enabling faster lookups, particularly in large datasets.</li></ul><h4 id=how-data-stored-in-db>How data stored in DB<a hidden class=anchor aria-hidden=true href=#how-data-stored-in-db>#</a></h4><ul><li>Logically, they are stored as rows and columns in DB</li></ul><h3 id=hash-index>Hash Index<a hidden class=anchor aria-hidden=true href=#hash-index>#</a></h3><h4 id=what-is-a-hash-index><strong>What Is a Hash Index?</strong><a hidden class=anchor aria-hidden=true href=#what-is-a-hash-index>#</a></h4><p>A hash index is a data structure that accelerates query operations by creating a mapping between key values in one or more columns of a table and their corresponding storage locations.</p><ul><li><strong>How It Works:</strong><ol><li>Hash Function<ul><li>Each key value is passed through a hash function, which transforms the key into a hash value.</li><li>A good hash function ensures that inputs are distributed uniformly across the hash space, minimizing clustering and hash collisions.</li></ul></li><li>Bucket Mapping<ul><li>The number of buckets, mm, is determined, which represents storage divisions in memory.</li><li>The specific bucket for a key is calculated as:Bucket Index=Hash Function(key)mod  mBucket Index=Hash Function(key)modm</li></ul></li><li>Handling Hash Collisions<ul><li><strong>Collision Definition</strong>: Two different keys may produce the same hash value, resulting in a collision.</li><li>Collision Resolution Methods<ul><li><strong>Chaining (Linked List)</strong>: Multiple values mapped to the same bucket are stored in a linked list.</li><li><strong>Open Addressing</strong>: If a bucket is already occupied, an alternative bucket is located based on a probing sequence (e.g., linear probing or quadratic probing).</li></ul></li></ul></li></ol></li><li><strong>Storage of Hash Index</strong>:<ul><li>The hash index is typically stored in <strong>RAM</strong> for fast access.</li><li>To ensure data durability in the event of failure, <strong>Write-Ahead Logging (WAL)</strong> or other persistence mechanisms can be used.</li></ul></li><li><strong>Pointer to Data Rows</strong>:<ul><li>The value in a hash index is a pointer or reference to the row in the table, allowing direct access to the data.</li></ul></li></ul><h4 id=time-complexity-of-hash-index><strong>Time Complexity of Hash Index</strong><a hidden class=anchor aria-hidden=true href=#time-complexity-of-hash-index>#</a></h4><ul><li><strong>Average Case</strong>: O(1)for lookups, insertions, and deletions, as hash functions provide direct access to buckets.</li><li><strong>Worst Case</strong>: O(n), which occurs when hash collisions lead to a single bucket storing many entries (e.g., all keys hashing to the same bucket).</li><li></li></ul><h4 id=why-use-a-hash-index><strong>Why Use a Hash Index?</strong><a hidden class=anchor aria-hidden=true href=#why-use-a-hash-index>#</a></h4><ul><li><strong>Advantages</strong>:</li></ul><ol><li>Efficient Query Performance<ul><li>Hash indices provide constant-time O(1)O(1) lookups for equality-based queries (<code>=</code> or <code>IN</code>).</li></ul></li><li>Low Memory Overhead<ul><li>Hash indices are compact and require less memory compared to tree-based indices like B-trees.</li></ul></li></ol><ul><li><strong>Limitations</strong>:</li></ul><ol><li>No Range Query Support<ul><li>Hash indices are unsuitable for range queries (e.g., <code>&lt;</code>, <code>></code>, <code>BETWEEN</code>) because hash functions do not preserve order.</li></ul></li><li>Random Distribution of Keys<ul><li>Hash functions distribute keys randomly across buckets, making ordered operations (like <code>ORDER BY</code>) impossible using the index.</li></ul></li><li>Collision Overhead<ul><li>Handling hash collisions adds complexity and may degrade performance in scenarios with poor hash function design or high data skew.</li></ul></li></ol><h4 id=additions-and-enhancements><strong>Additions and Enhancements</strong><a hidden class=anchor aria-hidden=true href=#additions-and-enhancements>#</a></h4><ol><li><strong>Durability</strong>:<ul><li>While you mentioned WAL for durability, it&rsquo;s worth noting that hash indices are often rebuilt after a crash if stored only in memory, making them better suited for <strong>temporary tables</strong> or <strong>volatile workloads</strong>.</li></ul></li><li><strong>Comparison to Other Index Types</strong>:<ul><li>Compared to B-tree indices:<ul><li>Hash indices are faster for equality queries.</li><li>B-trees are more versatile, supporting range queries, order maintenance, and prefix matching.</li></ul></li></ul></li><li><strong>Common Use Cases</strong>:<ul><li>Hash indices are ideal for:<ul><li>Lookup tables with frequent equality queries.</li><li>Key-value stores and in-memory databases (e.g., Redis).</li><li>Indexing columns with unique or near-unique values.</li></ul></li></ul></li></ol><h4 id=how-to-implement-hash-index>How to implement Hash Index<a hidden class=anchor aria-hidden=true href=#how-to-implement-hash-index>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>test</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>value</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>KEY</span><span class=p>(</span><span class=n>value</span><span class=p>)</span><span class=w> </span><span class=k>USING</span><span class=w> </span><span class=n>HASH</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>Memory</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=b-tree>B Tree<a hidden class=anchor aria-hidden=true href=#b-tree>#</a></h3><h4 id=why-do-we-need-b-tree>Why do we need B-Tree<a hidden class=anchor aria-hidden=true href=#why-do-we-need-b-tree>#</a></h4><ul><li>We want to query the data in log time</li></ul><h4 id=what-is-b-tree>What is B-Tree<a hidden class=anchor aria-hidden=true href=#what-is-b-tree>#</a></h4><ul><li>It&rsquo;s a balance tree: All the leaf nodes are on the same level</li><li>Multi-branching: With a m-order B-tree, it has<ul><li>Maximum m child nodes, minimum m/2 child nodes</li><li>Maximum m-1 keys in one node, minimum m/2 -1 leys in one node</li><li>(except for the root node)</li></ul></li><li>Order: Every keys are sorted in a ascending order</li><li>The value stored on each key is the pointer pointing to the corresponding row</li></ul><h4 id=insertion-in-b-tree>Insertion in B-Tree<a hidden class=anchor aria-hidden=true href=#insertion-in-b-tree>#</a></h4><ul><li>Starting from the root node, and navigating to the corresponding position on the leaf node. All keys in the node are sorted in the ascending order.</li><li>If the number of keys is greater than m-1, split the node into two, and push the middle key as the father node. (anchestor node?)</li></ul><h4 id=deletion-in-b-tree>Deletion in B-Tree<a hidden class=anchor aria-hidden=true href=#deletion-in-b-tree>#</a></h4><ul><li>Starting from the root node, and navigating to the corresponding position.</li><li>If the deletion target is the leaf node, delete it,</li><li>If the number of nodes after deleetion is smaller than m/2-1, take the sbling node as the new seperator in the parent node, and take the original seperator into the target leaf node</li><li>If the sbling node is also at the minumum nodes, then we can merge the target node, the separator and the sbling node together</li><li>If the target node is non-leaf node, we have to find an alternative key as the seprator, this could be the largest key on the left-hand child node, or the smallest key of the righ-hand side child node</li></ul><h4 id=io-of-b-tree>I/O of B-Tree<a hidden class=anchor aria-hidden=true href=#io-of-b-tree>#</a></h4><ul><li><p>The B-Tree is stored in hard Drive</p></li><li><p>Each time, it will read a single level of nodes into the RAM</p></li></ul><h3 id=b-tree-1>B+ Tree<a hidden class=anchor aria-hidden=true href=#b-tree-1>#</a></h3><p>Difference from B-Tree:</p><ul><li>In B-Tree, the values of all nodes contains to pointer pointing to the record</li><li>In B-Tree, only the leaf node contains the pointer pointing to the record</li><li>m order B-tree has maximum m-1 keys in a single mode</li><li>m order B+ tree has maximum m keys in a single mode, each key on the non-leaf node is the maximum value of it&rsquo;s childern node</li><li>B+ Tree has an additional pointer starting at the leaf node. Making it easy to do sequantial search and range query</li></ul><p>![image-20250112154345629](/Users/duanwenbo/Library/Application Support/typora-user-images/image-20250112154345629.png)</p><h3 id=clustered-and-non-clustered-index>Clustered and non-clustered Index<a hidden class=anchor aria-hidden=true href=#clustered-and-non-clustered-index>#</a></h3><ul><li>Note this is another dimention to describe index. The data srtrucuter is all B+ Tree by default.</li><li>The major difference is either we put the real data or the pointer on the leaf node</li></ul><p><img loading=lazy src=https://p.ipic.vip/mqqt28.png alt=image-20250112234117813></p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/notes/>Notes</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/option-trading-and-black-scholes/><span class=title>« Prev</span><br><span>Digest | Option Trading</span>
</a><a class=next href=http://localhost:1313/posts/what-i-talk-about-when-i-talk-about-running/><span class=title>Next »</span><br><span>Digest | 当我谈跑步时，我在谈些什么?</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Digest | SQL Quick Note 2 on x" href="https://x.com/intent/tweet/?text=Digest%20%7c%20SQL%20Quick%20Note%202&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2ftransaction%2f&amp;hashtags=Notes"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Digest | SQL Quick Note 2 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2ftransaction%2f&amp;title=Digest%20%7c%20SQL%20Quick%20Note%202&amp;summary=Digest%20%7c%20SQL%20Quick%20Note%202&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2ftransaction%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Digest | SQL Quick Note 2 on reddit" href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2ftransaction%2f&title=Digest%20%7c%20SQL%20Quick%20Note%202"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Digest | SQL Quick Note 2 on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2ftransaction%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Digest | SQL Quick Note 2 on whatsapp" href="https://api.whatsapp.com/send?text=Digest%20%7c%20SQL%20Quick%20Note%202%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2ftransaction%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Digest | SQL Quick Note 2 on telegram" href="https://telegram.me/share/url?text=Digest%20%7c%20SQL%20Quick%20Note%202&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2ftransaction%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Digest | SQL Quick Note 2 on ycombinator" href="https://news.ycombinator.com/submitlink?t=Digest%20%7c%20SQL%20Quick%20Note%202&u=http%3a%2f%2flocalhost%3a1313%2fposts%2ftransaction%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>🤗 Wenbo'Log</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>